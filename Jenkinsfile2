pipeline {
    agent {
        kubernetes {
            label 'jenkins-slave-pipeline-2'
            defaultContainer 'maven' // Changed default container to 'maven'
            yaml '''
            apiVersion: v1
            kind: Pod
            spec:
              containers:
              - name: maven
                image: maven:alpine
                command:
                - cat
                tty: true
            '''
        }
    }

    environment {
        DOCKER_IMAGE = "roiyki/persudoku-flask"
        DOCKERHUB_CREDENTIALS = 'dockerhub-credentials' // Define Docker Hub credentials
        DOCKERHUB_REGISTRY = 'https://hub.docker.com/roiyki/'
    }

    stages {
        node {
            checkout scm
            
            docker.withRegistry("$DOCKERHUB_REGISTRY", "$DOCKERHUB_CREDENTIALS")
            def testImage = docker.build("my-image:latest", "-f Dockerfile .app/Backend")

            customImage.push('latest')
        }
    }
}